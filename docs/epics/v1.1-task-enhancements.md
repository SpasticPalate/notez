# Epic: Notez v1.1 - Task Enhancements & Bug Fixes

**Epic ID:** EPIC-1.1
**Status:** Planning
**Target Release:** v1.1
**Created:** 2026-01-20
**Last Updated:** 2026-01-20

---

## Overview

Version 1.1 focuses on improving the task management experience with bug fixes for existing functionality and new features including a Kanban board view, task sorting, folder creation in dropdowns, and hyperlink support.

### Goals
- Fix 5 reported bugs affecting task and folder UX
- Add Kanban board view utilizing empty right pane
- Improve task organization with sorting and hyperlinks
- Streamline folder creation workflow

### Non-Goals
- Custom Kanban lanes (future consideration)
- Internal document linking (future - URLs only for now)
- Major architectural changes

---

## User Feedback Summary

Collected via in-app feedback form from production users.

---

## Bug Fixes

### BUG-001: Mobile Add Task Button Missing

**Priority:** High
**Complexity:** Low
**Affected Component:** TaskList.tsx

**Problem:**
The "Add Task" button is not visible in mobile view, preventing users from creating tasks on mobile devices.

**Acceptance Criteria:**
- [ ] Add Task button visible on mobile view
- [ ] Button placement consistent with mobile UI patterns (FAB or header)
- [ ] Tap target meets accessibility guidelines (44x44px minimum)

**Technical Notes:**
- Check responsive classes on header buttons in TaskList.tsx
- Likely hidden by `hidden md:block` class or similar
- Consider floating action button (FAB) pattern for mobile

---

### BUG-002: Task Title Shifts on Hover

**Priority:** High
**Complexity:** Low
**Affected Component:** TaskItem.tsx

**Problem:**
When hovering over a task item, the edit/delete buttons appear and push the task title text down, causing a jarring visual shift.

**Acceptance Criteria:**
- [ ] Edit/delete buttons appear on hover without shifting title
- [ ] Buttons overlay content with subtle background for readability
- [ ] Smooth transition animation (150-200ms)
- [ ] Touch devices: buttons always visible or accessible via long-press

**Technical Notes:**
- Current: Buttons likely in document flow, causing reflow
- Solution: Absolute positioning with overlay pattern
- Add semi-transparent background behind buttons

**UX Decision:** Use overlay pattern (buttons float over content)

---

### BUG-003: Completed Tasks Ignoring Hide/Show Filter

**Priority:** High
**Complexity:** Low
**Affected Component:** TaskList.tsx

**Problem:**
The "Show completed" filter checkbox doesn't properly filter completed tasks from the list.

**Acceptance Criteria:**
- [ ] When "Show completed" is unchecked, no completed tasks appear
- [ ] When "Show completed" is checked, completed tasks appear
- [ ] Filter state persists during session
- [ ] Task counts in stats update to reflect filtered view

**Technical Notes:**
- Check `showCompleted` state usage in API call params
- Verify backend `listTasks()` respects status filter
- May be client-side filtering vs server-side mismatch

---

### BUG-004: Folder Dropdown Missing Folders (Move Note)

**Priority:** Medium
**Complexity:** Medium
**Affected Component:** Note move functionality, folder dropdowns

**Problem:**
When attempting to move a note from one folder to another, some folders don't appear in the dropdown list. User reported "noir" folder was missing.

**Acceptance Criteria:**
- [ ] All user folders appear in move dropdown
- [ ] Folders sorted alphabetically for easy finding
- [ ] Current folder visually indicated (but still selectable)
- [ ] Empty state if no folders exist

**Technical Notes:**
- Investigate where note move dropdown fetches folder list
- Compare with FolderSidebar folder loading
- Check for filtering logic that might exclude folders
- May be related to folder ownership or soft-delete state

---

### BUG-005: Feedback Modal Disappears on Text Selection

**Priority:** Medium
**Complexity:** Medium
**Affected Component:** FeedbackModal.tsx

**Problem:**
The feedback modal randomly closes when the user is selecting text in a note. Reported in "suggest a feature" tab; "report a problem" worked fine in testing.

**Acceptance Criteria:**
- [ ] Modal stays open during text selection anywhere on page
- [ ] Modal only closes on explicit close action (X, Cancel, Submit success)
- [ ] Escape key still closes modal (intentional)
- [ ] Click outside modal behavior reviewed (should it close?)

**Technical Notes:**
- Likely event propagation issue with text selection
- Check for click-outside handlers that fire on mouseup after selection
- May need to check selection state before closing
- Test both tabs to identify difference

---

## Feature Requests

### FEAT-001: Task Sorting Options

**Priority:** Medium
**Complexity:** Low
**Affected Components:** TaskList.tsx, task.service.ts, tasks.routes.ts

**Description:**
Add ability to sort tasks by various fields to help users organize and find tasks.

**Sort Options:**
- Task name (A-Z, Z-A)
- Priority (Highâ†’Low, Lowâ†’High)
- Due date (Soonest first, Latest first)
- Created date (Newest, Oldest)
- Status (Pendingâ†’Completed, Completedâ†’Pending)

**Acceptance Criteria:**
- [ ] Sort dropdown in TaskList filter panel
- [ ] Default sort: Due date (soonest first), then priority
- [ ] Sort preference persists in session (localStorage optional)
- [ ] Sort works with existing filters (folder, priority, show completed)
- [ ] Clear visual indicator of current sort

**Technical Notes:**
- Add `sortBy` and `sortOrder` params to task list API
- Update `listTasks()` service to handle ORDER BY
- Frontend: Add sort state and UI control

---

### FEAT-002: Create New Folder in Task Location Dropdown

**Priority:** Medium
**Complexity:** Medium
**Affected Components:** TaskForm.tsx, folders.routes.ts

**Description:**
Allow users to create a new folder directly from the task creation/edit form without leaving the modal.

**Acceptance Criteria:**
- [ ] "Create new folder" option at bottom of folder dropdown
- [ ] Clicking opens inline input or mini-modal
- [ ] New folder created and automatically selected
- [ ] Folder list refreshes to include new folder
- [ ] Cancel returns to dropdown without creating
- [ ] Validation: folder name required, no duplicates

**Technical Notes:**
- Pattern: Inline input below dropdown or popover
- Call existing `POST /api/folders` endpoint
- Refresh folder list after creation
- Handle race condition if sidebar also updates

---

### FEAT-003: Task Hyperlinks

**Priority:** Medium
**Complexity:** Medium
**Affected Components:** TaskItem.tsx, TaskForm.tsx, schema.prisma, task.service.ts

**Description:**
Allow tasks to have multiple hyperlinks to external URLs (with future support for internal document links).

**Data Model:**
```prisma
model TaskLink {
  id        String   @id @default(uuid())
  taskId    String
  task      Task     @relation(fields: [taskId], references: [id], onDelete: Cascade)
  url       String
  label     String?
  type      String   @default("external")
  createdAt DateTime @default(now())

  @@index([taskId])
}
```

**Acceptance Criteria:**
- [ ] Tasks can have 0-10 hyperlinks
- [ ] Each link has URL (required) and label (optional)
- [ ] Links displayed as icon with popover in task list (Option C)
- [ ] Links editable in task edit form (add/remove/edit)
- [ ] URL validation (http/https only)
- [ ] Links open in new tab
- [ ] Label sanitized for XSS

**UI Specification:**
- Task list: Single link icon (ðŸ”—) if links exist, shows count badge
- Hover/click on icon: Popover with list of links
- Task form: "Links" section with add/remove interface

**Technical Notes:**
- New Prisma model + migration
- Update task service to include links in queries
- Update task create/update to handle links array
- Frontend: New LinkPopover component

---

### FEAT-004: Kanban Board View

**Priority:** High
**Complexity:** High
**Affected Components:** EditorPage.tsx, new TaskKanban.tsx

**Description:**
Add a Kanban board view in the currently empty right pane when viewing tasks. Provides visual task management with drag-and-drop between status lanes.

**Lanes (matching existing statuses):**
1. Pending
2. In Progress
3. Completed
4. Cancelled

**Acceptance Criteria:**
- [ ] Kanban board displays in right pane when Tasks view active
- [ ] Four lanes matching task statuses
- [ ] Tasks appear as cards in appropriate lane
- [ ] Drag-and-drop cards between lanes updates task status
- [ ] Optimistic UI update with rollback on API failure
- [ ] Cards show: title, priority badge, due date, link icon (if has links)
- [ ] Click card opens task edit modal
- [ ] Respects current folder filter (shows only that folder's tasks)
- [ ] Empty lanes show drop zone placeholder
- [ ] Filter interaction: "Hide completed" shows empty Completed lane

**Mobile Behavior:**
- [ ] Toggle button to switch between List and Kanban view
- [ ] Only one view visible at a time on mobile
- [ ] Kanban scrolls horizontally on small screens

**Technical Notes:**
- Use `@dnd-kit/core` for drag-and-drop (modern, accessible, maintained)
- New component: `TaskKanban.tsx`
- Shares task data with TaskList (lift state to EditorPage or use shared fetch)
- Reuse TaskItem styling for cards (or create TaskCard variant)

**Dependencies:**
- BUG-003 should be fixed first (filter behavior)
- FEAT-003 optional but enhances card display

---

## Technical Architecture

### Database Changes
- New `TaskLink` model (FEAT-003)
- Migration required

### API Changes
| Endpoint | Change | Feature |
|----------|--------|---------|
| GET /api/tasks | Add `sortBy`, `sortOrder` params | FEAT-001 |
| POST /api/tasks | Accept `links` array | FEAT-003 |
| PUT /api/tasks/:id | Accept `links` array | FEAT-003 |
| GET /api/tasks/:id | Include links in response | FEAT-003 |

### New Frontend Components
| Component | Purpose | Feature |
|-----------|---------|---------|
| TaskKanban.tsx | Kanban board view | FEAT-004 |
| TaskCard.tsx | Card for Kanban board | FEAT-004 |
| LinkPopover.tsx | Link list popover | FEAT-003 |
| InlineFolderCreate.tsx | Create folder in dropdown | FEAT-002 |

### Dependencies to Add
- `@dnd-kit/core` - Drag and drop
- `@dnd-kit/sortable` - Sortable lists (for within-lane ordering if needed)

---

## Implementation Order

### Phase 1: Bug Fixes (Priority)
1. BUG-001: Mobile Add Task button
2. BUG-002: Task title shift on hover
3. BUG-003: Completed tasks filter
4. BUG-004: Folder dropdown missing folders
5. BUG-005: Feedback modal disappearing

### Phase 2: Features
6. FEAT-001: Task sorting
7. FEAT-002: Create folder in dropdown
8. FEAT-003: Task hyperlinks (includes DB migration)
9. FEAT-004: Kanban board (largest feature)

---

## Success Metrics

- All 5 bugs verified fixed in production
- Kanban board usable on desktop and mobile
- No performance regression with Kanban rendering
- User feedback on new features (via existing feedback form)

---

## Open Questions

1. **Kanban card density:** How many tasks before we need virtualization?
2. **Sort persistence:** Session only, or save to user preferences in DB?
3. **Link previews:** Fetch title/favicon from URLs? (deferred - SSRF concerns)

---

## Appendix: File Reference

### Bug Fix Locations
- [TaskList.tsx](../../frontend/src/components/TaskList.tsx) - BUG-001, BUG-003
- [TaskItem.tsx](../../frontend/src/components/TaskItem.tsx) - BUG-002
- [TaskForm.tsx](../../frontend/src/components/TaskForm.tsx) - BUG-004
- [FeedbackModal.tsx](../../frontend/src/components/FeedbackModal.tsx) - BUG-005

### Feature Locations
- [EditorPage.tsx](../../frontend/src/pages/EditorPage.tsx) - FEAT-004
- [task.service.ts](../../backend/src/services/task.service.ts) - FEAT-001, FEAT-003
- [schema.prisma](../../backend/prisma/schema.prisma) - FEAT-003
